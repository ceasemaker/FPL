# FPL Pulse - Render Deployment Guide

## Prerequisites
- A Render account (https://render.com)
- Your GitHub repository connected to Render
- Review `.env.example` for required environment variables

## Environment Variables

The application uses environment variables for configuration. **DO NOT commit actual `.env` files to git.**

### Required Environment Variables:

All environment variables are configured in `render.yaml` and will be automatically set by Render. You can also set them manually in the Render dashboard:

#### Django Backend:
- `SECRET_KEY` - Django secret key (auto-generated by Render)
- `DEBUG` - Set to `false` in production
- `ALLOWED_HOSTS` - Comma-separated list of allowed hosts
- `DATABASE_URL` - PostgreSQL connection string (auto-set by Render)
- `REDIS_HOST` - Redis hostname (auto-set by Render)
- `REDIS_PORT` - Redis port (auto-set by Render)
- `REDIS_PASSWORD` - Redis password (auto-set by Render)
- `CORS_ALLOWED_ORIGINS` - Frontend URL for CORS

#### Frontend:
- `VITE_API_URL` - Backend API URL (e.g., `https://fpl-pulse-web.onrender.com`)

### Local Development:
1. Copy `.env.example` to `.env`
2. Update values for your local setup
3. Never commit `.env` to git (it's in `.gitignore`)

## Deployment Plans & Costs

### Services:
1. **Django Web Service** - Starter Plan ($7/month)
   - Runs the Django backend API
   - Includes migrations and gunicorn server

2. **Frontend Service** - Starter Plan ($7/month)
   - Serves the React/Vite frontend
   - Connects to the Django backend

### Databases:
1. **Redis** - Free Plan ($0/month)
   - Used for caching manager profiles

2. **PostgreSQL** - Starter Plan ($7/month)
   - Main database for FPL data

**Total Monthly Cost: $21/month**

## Deployment Steps

### Option 1: Deploy via Render Dashboard (Recommended)

1. **Connect Your Repository**
   - Go to https://render.com
   - Click "New +" â†’ "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect the `render.yaml` file

2. **Review Configuration**
   - Render will show all services defined in `render.yaml`
   - Review the plans and pricing
   - Click "Apply"

3. **Wait for Deployment**
   - Render will create all services
   - Databases will be provisioned first
   - Then web services will build and deploy
   - This takes about 10-15 minutes for initial deployment

4. **Access Your Application**
   - Frontend URL: `https://fpl-pulse-frontend.onrender.com`
   - Backend API: `https://fpl-pulse-web.onrender.com`

### Option 2: Deploy via Render CLI

```bash
# Install Render CLI
npm install -g @render-tools/cli

# Login to Render
render login

# Deploy the blueprint
render blueprint launch
```

## Post-Deployment Steps

### 1. Load Initial Data
After deployment, you'll need to populate the database with FPL data:

```bash
# Connect to your Django service shell
# (Use Render dashboard's "Shell" feature)

python manage.py shell

# Run your ETL scripts to load data
# This depends on your specific ETL setup
```

### 2. Update Environment Variables (Optional)
If you need to customize any settings:

- Go to your service in Render dashboard
- Click "Environment"
- Add or modify environment variables
- The service will automatically redeploy

### 3. Set Up Custom Domain (Optional)
- In Render dashboard, go to your frontend service
- Click "Settings" â†’ "Custom Domains"
- Add your custom domain
- Follow DNS instructions

## Important Notes

### CORS Configuration
The `render.yaml` configures CORS to allow the frontend to communicate with the backend. If you use custom domains, update:

```yaml
- key: CORS_ALLOWED_ORIGINS
  value: 'https://your-custom-domain.com'
```

### Database Migrations
Migrations run automatically on each deployment via the `startCommand` in `render.yaml`:

```yaml
startCommand: |
  cd django_etl
  python manage.py migrate
  gunicorn fpl_platform.wsgi:application --bind 0.0.0.0:$PORT
```

### Static Files
The frontend is built during deployment and served via Vite's preview server.

### Health Checks
The Django service includes a health check endpoint: `/api/landing/`

## Monitoring & Logs

### View Logs
- Go to your service in Render dashboard
- Click "Logs" tab
- View real-time logs

### Metrics
- CPU usage, memory, and bandwidth are shown in the dashboard
- Set up alerts for service issues

## Troubleshooting

### Build Failures
- Check the build logs in Render dashboard
- Ensure all dependencies are in `requirements.txt` and `package.json`
- Verify Python/Node versions match your local environment

### Database Connection Issues
- Ensure `DATABASE_URL` environment variable is set correctly
- Check if PostgreSQL database is running
- Verify migrations have run

### Redis Connection Issues
- Check if Redis instance is running
- Verify `REDIS_HOST`, `REDIS_PORT`, and `REDIS_PASSWORD` are set

### Frontend Can't Connect to Backend
- Verify `VITE_API_URL` is set correctly
- Check CORS configuration in Django settings
- Ensure backend service is running

## Updating Your Application

### Automatic Deployments
Render automatically deploys when you push to your main branch:

1. Make changes locally
2. Commit and push to GitHub
3. Render detects the change and redeploys

### Manual Deployments
- Go to your service in Render dashboard
- Click "Manual Deploy" â†’ "Deploy latest commit"

## Scaling

If your application grows:

1. **Upgrade Service Plans**
   - Starter â†’ Standard ($25/month per service)
   - Adds more CPU, RAM, and concurrent connections

2. **Upgrade Database Plans**
   - PostgreSQL Starter â†’ Standard ($20/month)
   - More storage and connections

3. **Add Background Workers**
   - Create additional services for ETL jobs
   - Use RQ or Celery for task queues

## Cost Optimization

### Free Tier Option (for testing)
You can use free plans for all services, but note:
- Free web services sleep after 15 minutes of inactivity
- Limited to 750 hours/month per service
- PostgreSQL free tier has 1GB storage limit

To use free tier, change plans in `render.yaml`:
```yaml
plan: free  # instead of starter
```

## Support

- Render Documentation: https://render.com/docs
- Render Community: https://community.render.com
- Your application logs in Render dashboard

## Security Recommendations

1. **Environment Variables**
   - Never commit sensitive data to git
   - Use Render's environment variables for secrets

2. **Database Backups**
   - Render automatically backs up PostgreSQL daily
   - Upgrade to Standard plan for more frequent backups

3. **HTTPS**
   - All Render services use HTTPS by default
   - No additional configuration needed

4. **Rate Limiting**
   - Consider adding Django rate limiting middleware
   - Use Django's built-in CSRF protection

## Next Steps

1. Deploy your application using the steps above
2. Test all features in production
3. Set up monitoring and alerts
4. Configure custom domain (optional)
5. Set up CI/CD for automated testing (optional)

Happy deploying! ðŸš€
